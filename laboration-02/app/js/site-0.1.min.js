function Message(n,t){this.getText=function(){return n};this.setText=function(){n=text};this.getDate=function(){return t};this.setDate=function(){t=t}}var MessageBoard={messages:[],textField:null,messageArea:null,init:function(){MessageBoard.textField=document.getElementById("inputText");MessageBoard.nameField=document.getElementById("inputName");MessageBoard.messageArea=document.getElementById("messagearea");document.getElementById("inputText").onfocus=function(){this.className="focus"};document.getElementById("inputText").onblur=function(){this.className="blur"};document.getElementById("buttonSend").onclick=function(){return MessageBoard.sendMessage(),!1};MessageBoard.textField.onkeypress=function(n){if(!n)var n=window.event;if(n.keyCode==13&&!n.shiftKey)return MessageBoard.sendMessage(),!1}},getAllMessages:function(){$.ajax({type:"GET",url:"get.php",data:{"function":"getAllMessages"},success:function(n){var i;n=JSON.parse(n);for(i in n){var t=n[i],r=t.name+" said:\n"+t.message,u=t.timestamp!=null?new Date(t.timestamp*1e3):new Date,i=new Message(r,u),f=MessageBoard.messages.push(i)-1;MessageBoard.renderMessage(f)}document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length},complete:MessageBoard.getNewMessages})},getNewMessages:function(){var n=$(".message").first(),t=$("span",n).text().replace(new RegExp("-","g"),"/"),i=Math.floor(Date.parse(t).valueOf()/1e3);$.ajax({type:"GET",url:"get.php",data:{"function":"getNewMessages",timestamp:i},success:function(n){var i;if(n!=""){n=JSON.parse(n);for(i in n){var t=n[i],r=t.name+" said:\n"+t.message,u=t.timestamp!=null?new Date(t.timestamp*1e3):new Date,i=new Message(r,u),f=MessageBoard.messages.push(i)-1;MessageBoard.renderMessage(f)}document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length}},complete:MessageBoard.getNewMessages})},sendMessage:function(){MessageBoard.textField.value!=""&&$.ajax({type:"GET",url:"post.php",data:{"function":"add",name:MessageBoard.nameField.value,message:MessageBoard.textField.value}}).done(function(){$("#inputText").val("")})},renderMessages:function(){MessageBoard.messageArea.innerHTML="";for(var n=0;n<MessageBoard.messages.length;++n)MessageBoard.renderMessage(n);document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length},renderMessage:function(n){var t=document.createElement("div"),i,r,u,f;t.className="message";aTag=document.createElement("a");aTag.href="#";aTag.onclick=function(){return MessageBoard.showTime(n),!1};i=document.createElement("img");i.src="pic/clock.png";i.alt="Show creation time";aTag.appendChild(i);t.appendChild(aTag);r=document.createElement("p");r.innerHTML=MessageBoard.messages[n].getHTMLText();t.appendChild(r);u=document.createElement("span");u.appendChild(document.createTextNode(MessageBoard.messages[n].getDateText()));t.appendChild(u);f=document.createElement("span");f.className="clear";t.appendChild(f);$("#messagearea").prepend(t)},removeMessage:function(n){window.confirm("Vill du verkligen radera meddelandet?")&&(MessageBoard.messages.splice(n,1),MessageBoard.renderMessages())},showTime:function(n){var t=MessageBoard.messages[n].getDate(),i="Created "+t.toLocaleDateString()+" at "+t.toLocaleTimeString();alert(i)}};Message.prototype.toString=function(){return this.getText()+" ("+this.getDate()+")"};Message.prototype.getHTMLText=function(){return this.getText().replace(/[\n\r]/g,"<br />")};Message.prototype.getDateText=function(){return this.getDate().toLocaleString()};window.onload=MessageBoard.init