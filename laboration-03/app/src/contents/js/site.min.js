"use strict";(function(n,t,i,r){function e(r,u){(this.options=n.extend({},o,u),this._container=n("#"+this.options.containerID),this._container.length)&&(this.jQwindow=n(t),this.jQdocument=n(i),this._holder=n(r),this._nav={},this._first=n(this.options.first),this._previous=n(this.options.previous),this._next=n(this.options.next),this._last=n(this.options.last),this._items=this._container.children(":visible"),this._itemsShowing=n([]),this._itemsHiding=n([]),this._numPages=Math.ceil(this._items.length/this.options.perPage),this._currentPageNum=this.options.startPage,this._clicked=!1,this._cssAnimSupport=this.getCSSAnimationSupport(),this.init())}var f="jPages",u=null,o={containerID:"",first:!1,previous:"←",next:"→",last:!1,links:"numeric",startPage:1,perPage:10,midRange:3,startRange:1,endRange:1,keyBrowse:!1,scrollBrowse:!1,pause:0,clickStop:!1,delay:50,direction:"forward",animation:"",fallback:400,minHeight:!0,callback:r};e.prototype={constructor:e,getCSSAnimationSupport:function(){var t=!1,e="animation",o="",i="Webkit Moz O ms Khtml".split(" "),u="",f=this._container.get(0),n;if(f.style.animationName&&(t=!0),t===!1)for(n=0;n<i.length;n++)if(f.style[i[n]+"AnimationName"]!==r){u=i[n];e=u+"Animation";o="-"+u.toLowerCase()+"-";t=!0;break}return t},init:function(){this.setStyles();this.setNav();this.paginate(this._currentPageNum);this.setMinHeight()},setStyles:function(){this._cssAnimSupport&&this.options.animation.length?this._items.addClass("animated jp-hidden"):this._items.hide()},setNav:function(){var t=this.writeNav();this._holder.each(this.bind(function(i,r){var u=n(r);u.html(t);this.cacheNavElements(u,i);this.bindNavHandlers(i);this.disableNavSelection(r)},this));this.options.keyBrowse&&this.bindNavKeyBrowse();this.options.scrollBrowse&&this.bindNavScrollBrowse()},writeNav:function(){for(var n=1,i,t=this.writeBtn("first")+this.writeBtn("previous");n<=this._numPages;n++){n===1&&this.options.startRange===0&&(t+="<li><span>...<\/span><\/li>");t+=n>this.options.startRange&&n<=this._numPages-this.options.endRange?"<li><a href='#' class='jp-hidden'>":"<li><a>";switch(this.options.links){case"numeric":t+=n;break;case"title":i=this._items.eq(n-1).attr("data-title");t+=i!==r?i:""}t+="<\/a><\/li>";(n===this.options.startRange||n===this._numPages-this.options.endRange)&&(t+="<li><span>...<\/span><\/li>")}return t+(this.writeBtn("next")+this.writeBtn("last"))},writeBtn:function(t){return this.options[t]!==!1&&!n(this["_"+t]).length?"<li><a class='jp-"+t+"'>"+this.options[t]+"<\/a><\/li>":""},cacheNavElements:function(t,i){this._nav[i]={};this._nav[i].holder=t;this._nav[i].first=this._first.length?this._first:this._nav[i].holder.find("a.jp-first");this._nav[i].previous=this._previous.length?this._previous:this._nav[i].holder.find("a.jp-previous");this._nav[i].next=this._next.length?this._next:this._nav[i].holder.find("a.jp-next");this._nav[i].last=this._last.length?this._last:this._nav[i].holder.find("a.jp-last");this._nav[i].fstBreak=this._nav[i].holder.find("span:first");this._nav[i].lstBreak=this._nav[i].holder.find("span:last");this._nav[i].pages=this._nav[i].holder.find("a").not(".jp-first, .jp-previous, .jp-next, .jp-last");this._nav[i].permPages=this._nav[i].pages.slice(0,this.options.startRange).add(this._nav[i].pages.slice(this._numPages-this.options.endRange,this._numPages));this._nav[i].pagesShowing=n([]);this._nav[i].currentPage=n([])},bindNavHandlers:function(t){var i=this._nav[t];i.holder.bind("click.jPages",this.bind(function(t){var r=this.getNewPage(i,n(t.target));this.validNewPage(r)&&(this._clicked=!0,this.paginate(r));t.preventDefault()},this));this._first.length&&this._first.bind("click.jPages",this.bind(function(){this.validNewPage(1)&&(this._clicked=!0,this.paginate(1))},this));this._previous.length&&this._previous.bind("click.jPages",this.bind(function(){var n=this._currentPageNum-1;this.validNewPage(n)&&(this._clicked=!0,this.paginate(n))},this));this._next.length&&this._next.bind("click.jPages",this.bind(function(){var n=this._currentPageNum+1;this.validNewPage(n)&&(this._clicked=!0,this.paginate(n))},this));this._last.length&&this._last.bind("click.jPages",this.bind(function(){this.validNewPage(this._numPages)&&(this._clicked=!0,this.paginate(this._numPages))},this))},disableNavSelection:function(n){typeof n.onselectstart!="undefined"?n.onselectstart=function(){return!1}:typeof n.style.MozUserSelect!="undefined"?n.style.MozUserSelect="none":n.onmousedown=function(){return!1}},bindNavKeyBrowse:function(){this.jQdocument.bind("keydown.jPages",this.bind(function(n){var i=n.target.nodeName.toLowerCase(),t;this.elemScrolledIntoView()&&i!=="input"&&i!="textarea"&&(t=this._currentPageNum,n.which==37&&(t=this._currentPageNum-1),n.which==39&&(t=this._currentPageNum+1),this.validNewPage(t)&&(this._clicked=!0,this.paginate(t)))},this))},elemScrolledIntoView:function(){var n,i,t,r;return n=this.jQwindow.scrollTop(),i=n+this.jQwindow.height(),t=this._container.offset().top,r=t+this._container.height(),r>=n&&t<=i},bindNavScrollBrowse:function(){this._container.bind("mousewheel.jPages DOMMouseScroll.jPages",this.bind(function(n){var t=(n.originalEvent.wheelDelta||-n.originalEvent.detail)>0?this._currentPageNum-1:this._currentPageNum+1;return this.validNewPage(t)&&(this._clicked=!0,this.paginate(t)),n.preventDefault(),!1},this))},getNewPage:function(n,t){return t.is(n.currentPage)?this._currentPageNum:t.is(n.pages)?n.pages.index(t)+1:t.is(n.first)?1:t.is(n.last)?this._numPages:t.is(n.previous)?n.pages.index(n.currentPage):t.is(n.next)?n.pages.index(n.currentPage)+2:void 0},validNewPage:function(n){return n!==this._currentPageNum&&n>0&&n<=this._numPages},paginate:function(t){var i,r;i=this.updateItems(t);r=this.updatePages(t);this._currentPageNum=t;n.isFunction(this.options.callback)&&this.callback(t,i,r);this.updatePause()},updateItems:function(n){var t=this.getItemRange(n);return this._itemsHiding=this._itemsShowing,this._itemsShowing=this._items.slice(t.start,t.end),this._cssAnimSupport&&this.options.animation.length?this.cssAnimations(n):this.jQAnimations(n),t},getItemRange:function(n){var t={};return t.start=(n-1)*this.options.perPage,t.end=t.start+this.options.perPage,t.end>this._items.length&&(t.end=this._items.length),t},cssAnimations:function(n){clearInterval(this._delay);this._itemsHiding.removeClass(this.options.animation+" jp-invisible").addClass("jp-hidden");this._itemsShowing.removeClass("jp-hidden").addClass("jp-invisible");this._itemsOriented=this.getDirectedItems(n);this._index=0;this._delay=setInterval(this.bind(function(){this._index===this._itemsOriented.length?clearInterval(this._delay):this._itemsOriented.eq(this._index).removeClass("jp-invisible").addClass(this.options.animation);this._index=this._index+1},this),this.options.delay)},jQAnimations:function(n){clearInterval(this._delay);this._itemsHiding.addClass("jp-hidden");this._itemsShowing.fadeTo(0,0).removeClass("jp-hidden");this._itemsOriented=this.getDirectedItems(n);this._index=0;this._delay=setInterval(this.bind(function(){this._index===this._itemsOriented.length?clearInterval(this._delay):this._itemsOriented.eq(this._index).fadeTo(this.options.fallback,1);this._index=this._index+1},this),this.options.delay)},getDirectedItems:function(t){var i;switch(this.options.direction){case"backwards":i=n(this._itemsShowing.get().reverse());break;case"random":i=n(this._itemsShowing.get().sort(function(){return Math.round(Math.random())-.5}));break;case"auto":i=t>=this._currentPageNum?this._itemsShowing:n(this._itemsShowing.get().reverse());break;default:i=this._itemsShowing}return i},updatePages:function(n){var i,r,t;i=this.getInterval(n);for(r in this._nav)this._nav.hasOwnProperty(r)&&(t=this._nav[r],this.updateBtns(t,n),this.updateCurrentPage(t,n),this.updatePagesShowing(t,i),this.updateBreaks(t,i));return i},getInterval:function(n){var t,i,r,u;return t=Math.ceil(this.options.midRange/2),i=this._numPages-this.options.midRange,r=n>t?Math.max(Math.min(n-t,i),0):0,u=n>t?Math.min(n+t-(this.options.midRange%2>0?1:0),this._numPages):Math.min(this.options.midRange,this._numPages),{start:r,end:u}},updateBtns:function(n,t){t===1&&(n.first.addClass("jp-disabled"),n.previous.addClass("jp-disabled"));t===this._numPages&&(n.next.addClass("jp-disabled"),n.last.addClass("jp-disabled"));this._currentPageNum===1&&t>1&&(n.first.removeClass("jp-disabled"),n.previous.removeClass("jp-disabled"));this._currentPageNum===this._numPages&&t<this._numPages&&(n.next.removeClass("jp-disabled"),n.last.removeClass("jp-disabled"))},updateCurrentPage:function(n,t){n.currentPage.removeClass("jp-current");n.currentPage.parent().removeClass("active");n.currentPage=n.pages.eq(t-1).addClass("jp-current");n.currentPage.parent().addClass("active")},updatePagesShowing:function(n,t){var i=n.pages.slice(t.start,t.end).not(n.permPages);n.pagesShowing.not(i).addClass("jp-hidden");i.not(n.pagesShowing).removeClass("jp-hidden");n.pagesShowing=i},updateBreaks:function(n,t){t.start>this.options.startRange||this.options.startRange===0&&t.start>0?n.fstBreak.removeClass("jp-hidden"):n.fstBreak.addClass("jp-hidden");t.end<this._numPages-this.options.endRange?n.lstBreak.removeClass("jp-hidden"):n.lstBreak.addClass("jp-hidden")},callback:function(n,t,i){var r={current:n,interval:i,count:this._numPages},u={showing:this._itemsShowing,oncoming:this._items.slice(t.start+this.options.perPage,t.end+this.options.perPage),range:t,count:this._items.length};r.interval.start=r.interval.start+1;u.range.start=u.range.start+1;this.options.callback(r,u)},updatePause:function(){if(this.options.pause&&this._numPages>1){if(clearTimeout(this._pause),this.options.clickStop&&this._clicked)return;this._pause=setTimeout(this.bind(function(){this.paginate(this._currentPageNum!==this._numPages?this._currentPageNum+1:1)},this),this.options.pause)}},setMinHeight:function(){this.options.minHeight&&!this._container.is("table, tbody")&&setTimeout(this.bind(function(){},this),1e3)},bind:function(n,t){return function(){return n.apply(t,arguments)}},destroy:function(){this.jQdocument.unbind("keydown.jPages");this._container.unbind("mousewheel.jPages DOMMouseScroll.jPages");this.options.minHeight&&this._container.css("min-height","");this._cssAnimSupport&&this.options.animation.length?this._items.removeClass("animated jp-hidden jp-invisible "+this.options.animation):this._items.removeClass("jp-hidden").fadeTo(0,1);this._holder.unbind("click.jPages").empty()}};n.fn[f]=function(t){var i=n.type(t);return i==="object"?(this.length&&!n.data(this,f)&&(u=new e(this,t),this.each(function(){n.data(this,f,u)})),this):i==="string"&&t==="destroy"?(u.destroy(),this.each(function(){n.removeData(this,f)}),this):i==="number"&&t%1==0?(u.validNewPage(t)&&u.paginate(t),this):this}})(jQuery,window,document);var site={};site=function(){function f(){$("#sortButtons").children("a").each(function(){$(this).attr("class")=="btn btn-default active"&&$(this).attr("class","btn btn-default")})}function e(){$("#sortButtons").children("a").each(function(){var t=$(this),n;switch(t.attr("id")){case"sortAllCat":n=null;break;case"sortRoadCat":n="Vägtrafik";break;case"sortPublicTransportCat":n="Kollektivtrafik";break;case"sortPlannedCat":n="Planerad störning";break;default:n="Övrigt"}t.click(function(){if(t.attr("class")!="btn btn-default active")return f(),t.attr("class","btn btn-default active"),i(n),!1})})}function i(n){u.renderTrafficMessages(n);t.renderTrafficMessages(n)}var o=this,r=new site.TrafficMessageService,n=r.getTrafficMessages(),u=new site.trafficMessageRenderer(n),t=new site.MapService($("#map-canvas")[0],n);this.startAnimation=function(n){t.startAnimation(n)};this.run=function(){e();i()}};site.trafficMessageRenderer=function(n){function i(n){var i=[];for(var r in n){var t=n[r],u=t.date.toLocaleString(),f={id:t.id,category:t.category,html:"<li><div id='"+t.id+"' class='panel panel-default'><div class='panel-heading'><h2>"+u+", "+t.title+"<\/h2><\/div><div class='panel-body trafficMessage'><p><i>"+t.category+" - "+t.subcategory+"<\/i><\/p><p>"+t.exactlocation+"<\/p><p>"+t.description+"<\/p><div><div><\/li>"};i.push(f)}return i}function r(n){var t,i;for(t in n)i=n[t],$("#"+i.id).click(function(){site.startAnimation($(this).attr("id"))})}function u(){$(function(){$("#paginationHolder").jPages({containerID:"trafficMessages",perPage:10});$("select").change(function(){var n=parseInt($(this).val());$("#paginationHolder").jPages("destroy").jPages({containerID:"trafficMessages",perPage:n})})})}function f(){$("#trafficMessages").html("")}var t=i(n);this.renderTrafficMessages=function(n){var e,i,o;for(f(),n=n!=undefined?n:null,e="",i=t.length-1;i>=0;i-=1)o=t[i],(n==null||n==o.category)&&(e+=o.html);$("#trafficMessages").html(e);r(t);u()}};site.MapService=function(n,t){function e(){var n,t;for(n in i)t=i[n],t.setMap(null)}function o(n){var t=n.date.toLocaleString();return"<div id='content'><h1 id='firstHeading' class='firstHeading'>"+t+"<\/i>, "+n.title+"<\/h1><div id='bodyContent'><p><i>"+n.category+" - "+n.subcategory+"<\/i><\/p><p>"+n.exactlocation+"<\/p><p>"+n.description+"<\/p><\/div><\/div>"}function s(n){var f=[],e,t,i;for(e in n)t=n[e],i=new google.maps.Marker({map:null,position:new google.maps.LatLng(t.latitude,t.longitude),title:t.title}),i.id=t.id,i.infoWindowContent=o(t),i.category=t.category,google.maps.event.addListener(i,"click",function(){r.setContent(this.infoWindowContent);r.open(u,this)}),f.push(i);return f}function h(n){setTimeout(function(){n.setAnimation(null)},2200)}var f={center:new google.maps.LatLng(63,17),zoom:5},r=new google.maps.InfoWindow,i=s(t),u=new google.maps.Map(n,f);this.startAnimation=function(n){var r,t;for(r in i)t=i[r],t.id==n&&(t.setAnimation(google.maps.Animation.BOUNCE),h(t))};this.renderTrafficMessages=function(n){var r,t;e();n=n!=undefined?n:null;for(r in i)t=i[r],(n==null||n==t.category)&&t.setMap(u)}};site.TrafficMessageService=function(){function t(){$.ajax({url:"index.php?action=getNewTrafficMessages",async:!1}).done(function(t){var i=jQuery.parseJSON(t),r,u;for(r in i.messages)u=i.messages[r],n.push(new site.TrafficMessage(u))}).fail(function(){alert("Ett fel intfräffade")})}var n=[];this.getTrafficMessages=function(){return t(),n}};site.escapeHtml=function(n){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(n).replace(/[&<>"'\/]/g,function(n){return t[n]})};site.TrafficMessage=function(n){this.id=site.escapeHtml(n.id);this.title=site.escapeHtml(n.title);this.latitude=site.escapeHtml(n.latitude);this.longitude=site.escapeHtml(n.longitude);this.exactlocation=site.escapeHtml(n.exactlocation);var t=n.createddate.match(/(\d+)/)[0];this.date=new Date(parseInt(t));switch(n.category){case 0:this.category=site.escapeHtml("Vägtrafik");break;case 1:this.category=site.escapeHtml("Kollektivtrafik");break;case 2:this.category=site.escapeHtml("Planerad störning");break;default:this.category=site.escapeHtml("Övrigt")}this.subcategory=site.escapeHtml(n.subcategory);this.description=site.escapeHtml(n.description)}